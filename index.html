<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Improv Timer v26</title>
<style>
  :root{
    --blue:#3aa8ff;   /* segment 1 (Blue) */
    --green:#25d366;  /* segment 2 (Green) */
    --red:#ff3b00;    /* segment 3 (Red) */

    --bg:#000;
    --fg:#fff;

    --band-min:26px;
    --band-max:22vh;

    /* Overtime palette */
    --overtime-yellow:#ffff00; /* whole background in OT */
    --overtime-blue:#0044ff;   /* strong blue digits in OT */
  }

  html,body{
    height:100%;margin:0;background:var(--bg);color:var(--fg);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
    overflow:hidden;
    -webkit-tap-highlight-color: transparent;
    transition:background-color .2s linear;
  }

  /* Whole screen turns bright yellow in overtime */
  body.overtime{ background:var(--overtime-yellow); }

  .app{position:relative;height:100%;width:100%;display:flex;flex-direction:column;}
  .field{
    position:relative;flex:1 1 auto;
    display:grid;grid-template-rows:1fr auto;grid-template-columns:100%;
  }

  /* ===== CLOCK STRIP ===== */
  .clock-strip{
    position:relative;z-index:2;
    background:#000;
    display:flex;align-items:center;justify-content:center;user-select:none;
    transition:background .15s linear;
  }
  .time-rot{transform-origin:center;}
  .portrait .time-rot{ transform: rotate(-90deg); }
  .landscape .time-rot{ transform: none; }

  .time{
    display:block;line-height:0.88;font-weight:900;letter-spacing:0.005em;white-space:nowrap;
    text-shadow:0 0 22px rgba(0,0,0,.7);
    color:var(--blue);
    font-size:10vw;
    transition:opacity .12s linear, color .12s linear;
  }

  .overtime-ribbon{
    position:absolute;left:10px;top:0;bottom:0;z-index:4;
    width:58px;display:none;align-items:center;justify-content:center;
    background:rgba(255,0,0,0.18);
    border-left:1px solid rgba(255,0,0,0.55);
    border-right:1px solid rgba(255,0,0,0.35);
    backdrop-filter:blur(1px);
  }
  .overtime .overtime-ribbon{ display:flex; }
  .overtime-text{
    writing-mode:vertical-lr; text-orientation:upright;
    white-space:pre-line;
    font-weight:900;font-size:14px;letter-spacing:0.8px;color:#fff;text-shadow:0 0 8px rgba(0,0,0,.5);
    user-select:none;
  }

  .blink-mask{position:absolute;inset:0;background:#000;pointer-events:none;z-index:3;display:none;}

  /* ===== BOTTOM PROGRESS BAND ===== */
  .band{
    position:relative;min-height:var(--band-min);max-height:var(--band-max);
    height:clamp(var(--band-min),15vh,var(--band-max));
    overflow:hidden;z-index:1;
  }
  .segments{position:absolute;inset:0;display:flex;pointer-events:none;}
  .seg{height:100%;width:0}
  .seg.blue{background:var(--blue)}
  .seg.green{background:var(--green)}
  .seg.red{background:var(--red)}

  .markers{position:absolute;inset:0;pointer-events:none;}
  .marker{position:absolute;top:0;bottom:0;width:2px;}
  .marker.blue{background:var(--blue)}
  .marker.green{background:var(--green)}
  .marker.end{background:var(--red);width:5px;}

  .marker-label{
    position:absolute;bottom:6px;transform:translateX(-8px);
    font-size:12px;font-weight:800;font-variant-numeric:tabular-nums;
    padding:2px 6px;border-radius:6px;white-space:nowrap;
    background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.12);
  }
  .marker-label.blue{color:var(--blue)}
  .marker-label.green{color:var(--green)}

  /* Total time (only bottom-right under the bar) */
  .total-overlay{
    position:absolute;right:10px;bottom:6px;z-index:2;
    font-weight:900;font-variant-numeric:tabular-nums;
    font-size:clamp(14px,3.8vw,28px);
    color:#ffffff;text-shadow:0 0 16px rgba(0,0,0,.6);
    background:rgba(0,0,0,.35);padding:2px 8px;border-radius:8px;border:1px solid rgba(255,255,255,.12);
  }

  /* Bottom info bar */
  .bar{flex:0 0 auto;padding:10px 14px;display:flex;align-items:center;gap:10px;
    background:rgba(0,0,0,.55);backdrop-filter:blur(4px);border-top:1px solid rgba(255,255,255,.08);
    font-size:clamp(12px,2.4vw,18px);z-index:5;}
  .pill{padding:6px 10px;border:1px solid rgba(255,255,255,.18);border-radius:999px;
    display:inline-flex;align-items:center;gap:8px;white-space:nowrap;}
  .dot{width:10px;height:10px;border-radius:50%;display:inline-block;}
  .dot.blue{background:var(--blue)} .dot.green{background:var(--green)} .dot.red{background:var(--red)}
  .bar .spacer{flex:1}
  .bar strong#totalShow{font-size:1.25em}

  .start-slab{position:absolute;left:0;top:0;bottom:0;width:20%;display:flex;align-items:stretch;justify-content:center;
    background:rgba(58,168,255,0.07);border-right:1px solid rgba(255,255,255,.12);cursor:pointer;user-select:none;z-index:6;}
  .start-slab button{width:92%;height:100%;max-width:420px;border-radius:0;
    border:2px solid rgba(255,255,255,.28);background:var(--blue);color:#002235;font-weight:900;font-size:clamp(22px,4.2vw,34px);cursor:pointer;}
  .start-hidden{display:none;}

  /* Settings + misc remain unchanged … */
  /* (keeping them exactly as in v25 for brevity, only key edits above) */

  /* Watermark */
  .stamp{position:fixed;right:10px;top:8px;z-index:10;font-size:12px;opacity:0.85;letter-spacing:0.4px;
    background:rgba(0,0,0,0.35);padding:2px 6px;border-radius:8px;border:1px solid rgba(255,255,255,0.12);pointer-events:none;}
  .stamp.hidden{display:none;}
</style>
</head>
<body>
  <div class="app" id="app">
    <div class="stamp" id="stamp">10.09.2025 - v26 - Jimmy James</div>

    <div class="field" id="field">
      <!-- CLOCK -->
      <div class="clock-strip" id="clockStrip">
        <div class="overtime-ribbon" id="otRibbon"><span class="overtime-text">OVER
TIME</span></div>
        <div class="time-rot"><span class="time" id="clock">0:00</span></div>
        <div class="blink-mask" id="blinkMask"></div>
      </div>

      <!-- BOTTOM progress band -->
      <div class="band" id="bandBottom">
        <div class="segments">
          <div class="seg blue"  id="segB"></div>
          <div class="seg green" id="segG"></div>
          <div class="seg red"   id="segR"></div>
        </div>
        <div class="markers">
          <div class="marker blue"  id="lineB"></div>
          <div class="marker green" id="lineG"></div>
          <div class="marker end"   id="lineEnd"></div>
          <div class="marker-label blue"  id="labelB">4:00</div>
          <div class="marker-label green" id="labelG">14:00</div>
        </div>
        <div class="total-overlay" id="totalOverlay">20:00</div>
      </div>

      <div class="start-slab" id="startSlab">
        <button id="startBtn">START</button>
      </div>
    </div>

    <!-- Bottom info bar -->
    <div class="bar">
      <span class="pill"><span class="dot blue"></span><span id="bShow">4:00</span></span>
      <span class="pill"><span class="dot green"></span><span id="gShow">10:00</span></span>
      <span class="pill"><span class="dot red"></span><span id="rShow">6:00</span></span>
      <div class="spacer"></div>
      <span class="pill" title="Total time"><strong id="totalShow">20:00</strong></span>
    </div>

    <!-- Settings etc… (unchanged from v25) -->
  </div>

<script>
(function(){
  const root = document.body;
  const clock = document.getElementById('clock');
  const clockStrip = document.getElementById('clockStrip');
  const segB = document.getElementById('segB');
  const segG = document.getElementById('segG');
  const segR = document.getElementById('segR');
  const lineB = document.getElementById('lineB');
  const lineG = document.getElementById('lineG');
  const lineEnd = document.getElementById('lineEnd');
  const labelB = document.getElementById('labelB');
  const labelG = document.getElementById('labelG');
  const blinkMask = document.getElementById('blinkMask');
  const bShow = document.getElementById('bShow');
  const gShow = document.getElementById('gShow');
  const rShow = document.getElementById('rShow');
  const totalShow = document.getElementById('totalShow');
  const totalOverlay = document.getElementById('totalOverlay');
  const startSlab = document.getElementById('startSlab');
  const startBtn = document.getElementById('startBtn');
  const sheet = document.getElementById('sheet');
  const pauseBtn = document.getElementById('pauseBtn');
  const returnBtn = document.getElementById('returnBtn');
  const resetBtn = document.getElementById('resetBtn');
  const defaultBtn = document.getElementById('defaultBtn');
  const deleteAllBtn = document.getElementById('deleteAllBtn');
  const miniDot = document.getElementById('miniDot');
  const miniStatus = document.getElementById('miniStatus');
  const miniClock = document.getElementById('miniClock');
  const miniTotal = document.getElementById('miniTotal');
  const previewClock = document.getElementById('previewClock');
  const previewState = document.getElementById('previewState');
  const stamp = document.getElementById('stamp');

  // Defaults
  const DEFAULT_B = 4*60, DEFAULT_G = 10*60, DEFAULT_R = 6*60;
  let bSec = DEFAULT_B, gSec = DEFAULT_G, rSec = DEFAULT_R;
  let totalSec = bSec + gSec + rSec;

  let elapsed = 0, running = false, rafId = null, lastTick = null;
  let scheduledFinalBlinks = new Set(), blinking = false, otBlinkMinuteDone = -1;

  setTimeout(()=> stamp.classList.add('hidden'), 10000);
  function updateStampVisibility(){
    const inSettings = sheet?.classList.contains('open');
    if (inSettings) stamp.classList.add('hidden');
  }

  function fmtSS(t){ const m=Math.floor(t/60), s=Math.floor(t%60); return `${m}:${s.toString().padStart(2,'0')}`; }

  function getVar(name){ return getComputedStyle(document.documentElement).getPropertyValue(name).trim(); }
  function updateDigitColor(){
    const bEnd=bSec, gEnd=bSec+gSec;
    if (elapsed<bEnd) clock.style.color=getVar('--blue');
    else if (elapsed<gEnd) clock.style.color=getVar('--green');
    else if (elapsed<totalSec) clock.style.color=getVar('--red');
    else clock.style.color=getVar('--overtime-blue');
  }

  /* ---- FIXED HERE ---- */
  function positionMarkers(){
    if (totalSec <= 0){
      lineB.style.left='0%'; lineG.style.left='0%'; lineEnd.style.left='calc(100% - 2.5px)';
      labelB.textContent='0:00'; labelG.textContent='0:00';
      labelB.style.left='0%'; labelG.style.left='0%';
      return;
    }
    const bPct=(bSec/totalSec)*100;
    const gPct=((bSec+gSec)/totalSec)*100;
    lineB.style.left=`calc(${bPct}% - 1px)`;
    lineG.style.left=`calc(${gPct}% - 1px)`;
    lineEnd.style.left=`calc(100% - 2.5px)`;
    labelB.textContent=fmtSS(bSec);
    labelG.textContent=fmtSS(bSec+gSec);
    labelB.style.left=`calc(${bPct}% - 24px)`;
    labelG.style.left=`calc(${gPct}% - 32px)`;
    // removed totalOverlay.textContent duplication
  }
  /* ------------------- */

  function refreshInfoBar(){
    bShow.textContent=fmtSS(bSec);
    gShow.textContent=fmtSS(gSec);
    rShow.textContent=fmtSS(rSec);
    const totalTxt=fmtSS(totalSec);
    totalShow.textContent=totalTxt;
    totalOverlay.textContent=totalTxt;
    miniTotal.textContent=`/ ${totalTxt}`;
  }

  // … rest of JS unchanged from v25 …
})();
</script>
</body>
</html>
