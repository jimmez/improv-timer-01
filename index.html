<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Improv Timer v11.4</title>
<style>
  :root{
    --blue:#3aa8ff;
    --green:#25d366;
    --red:#ff3b00;
    --after:#9fdcff;

    --bg:#000;
    --fg:#fff;
    --danger:#ff2222;

    --band-min:28px;
    --band-max:24vh;
  }

  html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:sans-serif;overflow:hidden;}

  .app{position:relative;height:100%;width:100%;display:flex;flex-direction:column;}
  .field{position:relative;flex:1 1 auto;overflow:hidden;background:var(--bg);
    display:grid;grid-template-rows:1fr auto;grid-template-columns:100%;}

  .clock-strip{position:relative;background:#000;z-index:2;display:flex;align-items:center;justify-content:center;}
  .time-rot{transform-origin:center;}
  .portrait .time-rot{ transform: rotate(-90deg); }
  .landscape .time-rot{ transform: none; }
  .time{display:block;line-height:0.9;font-weight:900;letter-spacing:0.005em;
    white-space:nowrap;text-shadow:0 0 22px rgba(0,0,0,.7);font-size:10vw;}

  .end-blink{position:absolute;inset:0;pointer-events:none;z-index:4;background:var(--bg);
    animation:endBlink .5s steps(2,jump-none) infinite;display:none;}
  @keyframes endBlink{0%{background:var(--bg)}50%{background:var(--danger)}100%{background:var(--danger)}}

  .band{position:relative;min-height:var(--band-min);max-height:var(--band-max);
    height:clamp(var(--band-min),18vh,var(--band-max));overflow:hidden;z-index:1;}
  .segments{position:absolute;inset:0;display:flex;}
  .seg{height:100%;width:0;}
  .seg.blue{background:var(--blue);}
  .seg.green{background:var(--green);}
  .seg.red{background:var(--red);}

  .markers{position:absolute;inset:0;}
  .marker{position:absolute;top:0;bottom:0;width:2px;}
  .marker.blue{background:var(--blue);}
  .marker.green{background:var(--green);}
  .marker.end{background:var(--red);width:4px;} /* thicker red end line */

  .marker-label{
    position:absolute;bottom:6px;font-size:12px;font-weight:800;
    font-variant-numeric:tabular-nums;padding:2px 6px;border-radius:6px;
    background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.12);white-space:nowrap;
  }
  .marker-label.blue{color:var(--blue);}
  .marker-label.green{color:var(--green);}
  .marker-label.red{color:var(--red);}

  .total-overlay{
    position:absolute;right:10px;bottom:6px;z-index:2;
    font-weight:900;font-variant-numeric:tabular-nums;
    font-size:clamp(14px,3.8vw,28px);color:#fff;
    background:rgba(0,0,0,.35);padding:2px 8px;border-radius:8px;border:1px solid rgba(255,255,255,.12);
  }
</style>
</head>
<body>
  <div class="app">
    <div class="field">
      <!-- CLOCK -->
      <div class="clock-strip">
        <div class="time-rot"><span class="time" id="clock">0:00</span></div>
      </div>

      <!-- BOTTOM BAR -->
      <div class="band">
        <div class="segments">
          <div class="seg blue" id="segB"></div>
          <div class="seg green" id="segG"></div>
          <div class="seg red" id="segR"></div>
        </div>
        <div class="markers">
          <div class="marker blue"  id="lineB"></div>
          <div class="marker green" id="lineG"></div>
          <div class="marker end"   id="lineEnd"></div>

          <div class="marker-label blue"  id="labelB">4:00</div>
          <div class="marker-label green" id="labelG">14:00</div>
          <!-- Red label placed left of red line -->
          <div class="marker-label red"   id="labelEnd">20:00</div>
        </div>
        <!-- White overlay total -->
        <div class="total-overlay" id="totalOverlay">20:00</div>
      </div>

      <div class="end-blink" id="endBlink"></div>
    </div>
  </div>

<script>
(function(){
  const clock=document.getElementById('clock');
  const segB=document.getElementById('segB');
  const segG=document.getElementById('segG');
  const segR=document.getElementById('segR');
  const lineB=document.getElementById('lineB');
  const lineG=document.getElementById('lineG');
  const lineEnd=document.getElementById('lineEnd');
  const labelB=document.getElementById('labelB');
  const labelG=document.getElementById('labelG');
  const labelEnd=document.getElementById('labelEnd');
  const totalOverlay=document.getElementById('totalOverlay');

  let bSec=4*60,gSec=10*60,rSec=6*60;
  let totalSec=bSec+gSec+rSec;

  function fmtSS(t){const m=Math.floor(t/60),s=Math.floor(t%60);return `${m}:${s.toString().padStart(2,'0')}`;}

  function positionMarkers(){
    const bPct=(bSec/totalSec)*100;
    const gPct=((bSec+gSec)/totalSec)*100;
    lineB.style.left=`calc(${bPct}% - 1px)`;
    lineG.style.left=`calc(${gPct}% - 1px)`;
    lineEnd.style.left=`calc(100% - 2px)`; // end of bar
    labelB.style.left=`calc(${bPct}% - 24px)`; // left of blue line
    labelG.style.left=`calc(${gPct}% - 32px)`; // left of green line
    labelEnd.style.left=`calc(100% - 40px)`;   // left of red line
  }

  function init(){
    labelB.textContent=fmtSS(bSec);
    labelG.textContent=fmtSS(bSec+gSec);
    labelEnd.textContent=fmtSS(totalSec);
    totalOverlay.textContent=fmtSS(totalSec);
    positionMarkers();
    clock.textContent="0:00";
  }

  window.addEventListener('resize', positionMarkers);
  init();
})();
</script>
</body>
</html>
