<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Improv Timer</title>
<style>
  :root{
    --yellow:#ffd400;
    --green:#1db954;
    --blue:#66d1ff; /* light blue */
    --bg:#000000;
    --fg:#ffffff;
    --danger:#ff2222;
  }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;overflow:hidden;}

  .app{position:relative;height:100%;width:100%;display:flex;flex-direction:column;}

  .field{position:relative;flex:1 1 auto;overflow:hidden;background:var(--bg);}

  /* Segments (accumulating yellow→green→blue) */
  .segments{position:absolute;inset:0;display:flex;pointer-events:none;z-index:1;}
  .seg{height:100%;width:0}
  .seg.yellow{background:var(--yellow)}
  .seg.green{background:var(--green)}
  .seg.blue{background:var(--blue)}

  /* Marker lines + time labels at bottom */
  .markers{position:absolute;inset:0;pointer-events:none;z-index:9;}
  .marker{position:absolute;top:0;bottom:0;width:2px;opacity:.98;}
  .marker.yellow{background:var(--yellow)}
  .marker.green{background:var(--green)}
  .marker.blue{background:var(--blue)}
  .marker-label{
    position:absolute;bottom:6px;display:flex;align-items:center;gap:6px;
    font-size:12px;opacity:0.9;background:rgba(0,0,0,.35);
    padding:2px 6px;border-radius:6px;border:1px solid rgba(255,255,255,.12);
    white-space:nowrap;pointer-events:none;
  }
  .marker-label.left { transform: translateX(-8px); }  /* to the left of line */
  .marker-label.right{ transform: translateX(8px); }   /* to the right of line */
  .label-dot{width:9px;height:9px;border-radius:50%;display:inline-block}
  .label-dot.yellow{background:var(--yellow)}
  .label-dot.green{background:var(--green)}
  .label-dot.blue{background:var(--blue)}

  /* Orientation-aware stopwatch */
  .time-wrap{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;z-index:2;pointer-events:none;}
  .time-rot{transform-origin:center;}
  .portrait .time-rot{ transform: rotate(-90deg); }  /* portrait: bottom→top */
  .landscape .time-rot{ transform: none; }           /* landscape: horizontal */
  .time{display:block;line-height:0.9;font-weight:900;letter-spacing:0.02em;white-space:nowrap;
    text-shadow:0 0 22px rgba(0,0,0,.7);}

  /* Blink overlays */
  .blink-mask{position:absolute;inset:0;background:#000;pointer-events:none;z-index:5;display:none;}

  /* End-of-timer black/red blink */
  .end-blink{position:absolute;inset:0;pointer-events:none;z-index:6;background:var(--bg);
    animation:endBlink .5s steps(2,jump-none) infinite;display:none;}
  @keyframes endBlink{0%{background:var(--bg)}50%{background:var(--danger)}100%{background:var(--danger)}}

  /* Bottom info bar */
  .bar{flex:0 0 auto;padding:10px 14px;display:flex;align-items:center;gap:10px;
    background:rgba(0,0,0,.55);backdrop-filter:blur(4px);border-top:1px solid rgba(255,255,255,.08);
    font-size:clamp(12px,2.4vw,18px);z-index:4;}
  .pill{padding:6px 10px;border:1px solid rgba(255,255,255,.18);border-radius:999px;
    display:inline-flex;align-items:center;gap:8px;white-space:nowrap;}
  .dot{width:10px;height:10px;border-radius:50%;display:inline-block;}
  .dot.yellow{background:var(--yellow)} .dot.green{background:var(--green)} .dot.blue{background:var(--blue)}
  .bar .spacer{flex:1}

  /* Start slab (left 20%) */
  .start-slab{
    position:absolute;left:0;top:0;bottom:0;width:20%;
    display:flex;align-items:center;justify-content:center;
    background:rgba(102,209,255,0.07);border-right:1px solid rgba(255,255,255,.12);
    cursor:pointer;user-select:none;z-index:7;
  }
  .start-slab button{
    width:88%;max-width:340px;padding:18px 12px;border-radius:16px;
    border:2px solid rgba(255,255,255,.28);background:var(--blue);color:#002235;
    font-weight:900;font-size:clamp(18px,3.8vw,28px);box-shadow:0 10px 30px rgba(0,0,0,.45);cursor:pointer;
  }
  .start-hidden{display:none;}

  /* Settings FAB (auto-hide: show 5s after tap) */
  .fab{
    position:fixed;right:18px;bottom:calc(64px + 18px);width:64px;height:64px;border-radius:50%;
    background:var(--blue);color:#00324a;display:flex;align-items:center;justify-content:center;
    font-weight:900;font-size:28px;box-shadow:0 8px 24px rgba(0,0,0,.45);cursor:pointer;user-select:none;
    z-index:10;border:2px solid rgba(255,255,255,.3);
    opacity:0;pointer-events:none;transition:opacity .2s ease;
  }
  .fab.show{opacity:1;pointer-events:auto;}
  .fab:active{transform:scale(.98)}

  /* Settings sheet */
  .sheet{position:fixed;inset:0;background:rgba(0,0,0,.66);display:none;align-items:center;justify-content:center;z-index:11;}
  .sheet.open{display:flex}
  .card{width:min(860px,92vw);background:#0b0b0b;color:var(--fg);border:1px solid rgba(255,255,255,.12);border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.6);padding:18px;}
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap;}
  .row + .row{margin-top:12px;}
  .group{flex:1 1 260px;min-width:260px;background:#121212;border:1px solid rgba(255,255,255,.14);border-radius:12px;padding:12px;}
  .group h4{margin:0 0 8px 0;display:flex;align-items:center;gap:8px;font-size:16px}
  .counter{display:flex;align-items:center;gap:8px;margin-top:6px;}
  .lbl{opacity:.8;font-size:12px;min-width:70px}
  .btnStep{border:1px solid rgba(255,255,255,.18);background:#101010;color:var(--fg);padding:6px 10px;border-radius:10px;font-weight:700;cursor:pointer;min-width:44px;text-align:center}
  .val{padding:6px 10px;border:1px dashed rgba(255,255,255,.24);border-radius:10px;min-width:72px;text-align:center;font-variant-numeric:tabular-nums;}

  .btn{border:1px solid rgba(255,255,255,.18);background:#101010;color:var(--fg);padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer;}
  .btn.primary{background:var(--blue);color:#002235}
  .btn.warn{background:#1a0000;color:#ffb3b3;border-color:#551111}
  .hint{opacity:.7;font-size:12px}

  /* Single stamp (v6) */
  .stamp{position:fixed;right:10px;top:8px;z-index:12;font-size:12px;opacity:0.85;letter-spacing:0.4px;
    background:rgba(0,0,0,0.35);padding:2px 6px;border-radius:8px;border:1px solid rgba(255,255,255,0.12);}
</style>
</head>
<body>
  <div class="app" id="app">
    <div class="stamp">08.09.2025 - v6 - Jimmy James</div>

    <div class="field" id="field">
      <!-- Accumulating segments -->
      <div class="segments">
        <div class="seg yellow" id="segY"></div>
        <div class="seg green" id="segG"></div>
        <div class="seg blue"   id="segB"></div>
      </div>

      <!-- Marker lines + labels -->
      <div class="markers">
        <div class="marker yellow" id="markerY"></div>
        <div class="marker green"  id="markerG"></div>
        <div class="marker blue"   id="markerB"></div>

        <div class="marker-label left"  id="labelY">
          <span class="label-dot yellow"></span><span id="labelYText">3:00</span>
        </div>
        <div class="marker-label left"  id="labelG">
          <span class="label-dot green"></span><span id="labelGText">17:00</span>
        </div>
        <div class="marker-label right" id="labelB">
          <span class="label-dot blue"></span><span id="labelBText">20:00</span>
        </div>
      </div>

      <!-- Blink overlays -->
      <div class="blink-mask" id="blinkMask"></div>
      <div class="end-blink" id="endBlink"></div>

      <!-- Stopwatch -->
      <div class="time-wrap">
        <div class="time-rot">
          <span class="time" id="clock">0:00</span>
        </div>
      </div>

      <!-- Big left START slab -->
      <div class="start-slab" id="startSlab">
        <button id="startBtn">START</button>
      </div>
    </div>

    <!-- Bottom status bar -->
    <div class="bar">
      <span class="pill"><span class="dot yellow"></span><span id="yShow">3:00</span></span>
      <span class="pill"><span class="dot green"></span><span id="gShow">14:00</span></span>
      <span class="pill"><span class="dot blue"></span><span id="bShow">3:00</span></span>
      <div class="spacer"></div>
      <span class="pill" title="Total time"><strong id="totalShow">20:00</strong></span>
    </div>

    <!-- Auto-hiding Settings FAB -->
    <div class="fab" id="settingsFab" title="Settings">⚙️</div>

    <!-- Settings -->
    <div class="sheet" id="sheet">
      <div class="card">
        <h2 style="margin:6px 2px 12px 2px;">Improv Timer Settings</h2>

        <div class="row">
          <!-- Yellow -->
          <div class="group">
            <h4><span class="dot yellow"></span> Yellow</h4>
            <div class="counter">
              <span class="lbl">Minutes</span>
              <button class="btnStep" data-seg="y" data-kind="m" data-d="-1">−</button>
              <span class="val" id="yMinVal">3</span>
              <button class="btnStep" data-seg="y" data-kind="m" data-d="1">+</button>
            </div>
            <div class="counter">
              <span class="lbl">Seconds</span>
              <button class="btnStep" data-seg="y" data-kind="s" data-d="-1">−</button>
              <span class="val" id="ySecVal">00</span>
              <button class="btnStep" data-seg="y" data-kind="s" data-d="1">+</button>
            </div>
          </div>

          <!-- Green -->
          <div class="group">
            <h4><span class="dot green"></span> Green</h4>
            <div class="counter">
              <span class="lbl">Minutes</span>
              <button class="btnStep" data-seg="g" data-kind="m" data-d="-1">−</button>
              <span class="val" id="gMinVal">14</span>
              <button class="btnStep" data-seg="g" data-kind="m" data-d="1">+</button>
            </div>
            <div class="counter">
              <span class="lbl">Seconds</span>
              <button class="btnStep" data-seg="g" data-kind="s" data-d="-1">−</button>
              <span class="val" id="gSecVal">00</span>
              <button class="btnStep" data-seg="g" data-kind="s" data-d="1">+</button>
            </div>
          </div>

          <!-- Light Blue -->
          <div class="group">
            <h4><span class="dot blue"></span> Light Blue</h4>
            <div class="counter">
              <span class="lbl">Minutes</span>
              <button class="btnStep" data-seg="b" data-kind="m" data-d="-1">−</button>
              <span class="val" id="bMinVal">3</span>
              <button class="btnStep" data-seg="b" data-kind="m" data-d="1">+</button>
            </div>
            <div class="counter">
              <span class="lbl">Seconds</span>
              <button class="btnStep" data-seg="b" data-kind="s" data-d="-1">−</button>
              <span class="val" id="bSecVal">00</span>
              <button class="btnStep" data-seg="b" data-kind="s" data-d="1">+</button>
            </div>
          </div>
        </div>

        <div class="row">
          <button class="btn" id="pauseBtn">Pause</button>
          <button class="btn primary" id="returnBtn">Return</button>
          <button class="btn warn" id="resetBtn" title="Triple-click to reset">Reset ×3</button>
          <div class="spacer"></div>
          <span class="hint">Save by clicking the blue ⚙️ again.</span>
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  const root = document.body;

  const clock = document.getElementById('clock');
  const field = document.getElementById('field');

  const segY = document.getElementById('segY');
  const segG = document.getElementById('segG');
  const segB = document.getElementById('segB');

  const markerY = document.getElementById('markerY');
  const markerG = document.getElementById('markerG');
  const markerB = document.getElementById('markerB');
  const labelY  = document.getElementById('labelY');
  const labelG  = document.getElementById('labelG');
  const labelB  = document.getElementById('labelB');
  const labelYText = document.getElementById('labelYText');
  const labelGText = document.getElementById('labelGText');
  const labelBText = document.getElementById('labelBText');

  const blinkMask = document.getElementById('blinkMask');
  const endBlink = document.getElementById('endBlink');

  const yShow = document.getElementById('yShow');
  const gShow = document.getElementById('gShow');
  const bShow = document.getElementById('bShow');
  const totalShow = document.getElementById('totalShow');

  const startSlab = document.getElementById('startSlab');
  const startBtn = document.getElementById('startBtn');

  const fab = document.getElementById('settingsFab');
  const sheet = document.getElementById('sheet');
  const pauseBtn = document.getElementById('pauseBtn');
  const returnBtn = document.getElementById('returnBtn');
  const resetBtn = document.getElementById('resetBtn');

  const yMinVal = document.getElementById('yMinVal');
  const ySecVal = document.getElementById('ySecVal');
  const gMinVal = document.getElementById('gMinVal');
  const gSecVal = document.getElementById('gSecVal');
  const bMinVal = document.getElementById('bMinVal');
  const bSecVal = document.getElementById('bSecVal');

  // State (seconds)
  let ySec = 3*60, gSec = 14*60, bSec = 3*60;
  let totalSec = ySec + gSec + bSec;

  let elapsed = 0; // seconds
  let running = false;
  let rafId = null;
  let lastTick = null;

  let scheduledBlueBlinks = new Set();
  let blinking = false;

  /* ---------- Orientation handling ---------- */
  function applyOrientationClass(){
    const portrait = window.innerHeight >= window.innerWidth;
    root.classList.toggle('portrait', portrait);
    root.classList.toggle('landscape', !portrait);
  }

  /* ---------- Font fitting (orientation-aware) ---------- */
  function fitClock(){
    const rect = field.getBoundingClientRect();
    if (rect.width <= 0 || rect.height <= 0) return;

    const isPortrait = root.classList.contains('portrait');

    if (isPortrait){
      const maxRotW = rect.width * 0.98;
      const maxRotH = rect.height * 0.96;
      let lo=4, hi=Math.max(12, rect.height);
      const fits = (px)=>{
        clock.style.fontSize = px + 'px';
        const W = clock.scrollWidth, H = clock.scrollHeight;
        const rotW = H, rotH = W;
        return (rotW <= maxRotW) && (rotH <= maxRotH);
      };
      while (fits(hi) && hi < rect.height*3) hi *= 1.25;
      while (hi - lo > 1){ const mid = Math.floor((lo+hi)/2); if (fits(mid)) lo = mid; else hi = mid; }
      clock.style.fontSize = lo + 'px';
    } else {
      const maxW = rect.width * 0.98;
      const maxH = rect.height * 0.92;
      let lo=4, hi=Math.max(12, rect.height);
      const fits = (px)=>{
        clock.style.fontSize = px + 'px';
        const W = clock.scrollWidth, H = clock.scrollHeight;
        return (H <= maxH) && (W <= maxW);
      };
      while (fits(hi) && hi < rect.height*3) hi *= 1.25;
      while (hi - lo > 1){ const mid = Math.floor((lo+hi)/2); if (fits(mid)) lo = mid; else hi = mid; }
      clock.style.fontSize = lo + 'px';
    }
  }
  const fitClockThrottled = throttle(()=>{ applyOrientationClass(); fitClock(); }, 50);

  function throttle(fn, ms){
    let last = 0, t;
    return function(){
      const now = performance.now();
      if (now - last >= ms){ last = now; fn(); }
      else { clearTimeout(t); t = setTimeout(()=>{ last = performance.now(); fn(); }, ms - (now - last)); }
    };
  }

  /* ---------- Formatters ---------- */
  function fmtSS(t){
    const m = Math.floor(t/60);
    const s = Math.floor(t%60);
    return `${m}:${s.toString().padStart(2,'0')}`;
  }

  /* ---------- Labels & markers ---------- */
  function positionMarkers(){
    const yPct = totalSec ? (ySec/totalSec)*100 : 0;
    const gPct = totalSec ? ((ySec+gSec)/totalSec)*100 : 0;
    const bPct = 100;

    markerY.style.left = `calc(${yPct}% - 1px)`;
    markerG.style.left = `calc(${gPct}% - 1px)`;
    markerB.style.left = `calc(${bPct}% - 1px)`;

    // Update texts (cumulative endpoints only)
    labelYText.textContent = fmtSS(ySec);
    labelGText.textContent = fmtSS(ySec+gSec);
    labelBText.textContent = fmtSS(totalSec);

    // Position labels: left of yellow/green, right of blue
    labelY.style.left = `calc(${yPct}% - 8px)`;
    labelG.style.left = `calc(${gPct}% - 8px)`;
    labelB.style.left = `calc(${bPct}% + 8px)`;
  }

  function refreshInfoBar(){
    yShow.textContent = fmtSS(ySec);
    gShow.textContent = fmtSS(gSec);
    bShow.textContent = fmtSS(bSec);
    totalShow.textContent = fmtSS(totalSec);
  }

  /* ---------- Segments fill ---------- */
  function updateSegments(sec){
    const pctTotal = totalSec ? (sec/totalSec)*100 : 0;
    const yPct = totalSec ? (ySec/totalSec)*100 : 0;
    const gPct = totalSec ? (gSec/totalSec)*100 : 0;
    const bPct = 100 - yPct - gPct;

    const yW = Math.min(pctTotal, yPct);
    const gW = Math.min(Math.max(pctTotal - yPct, 0), gPct);
    const bW = Math.min(Math.max(pctTotal - yPct - gPct, 0), bPct);

    segY.style.width = yW + '%';
    segG.style.width = gW + '%';
    segB.style.width = bW + '%';
  }

  /* ---------- Timer control ---------- */
  function start(){
    if (running || totalSec === 0) return;
    running = true;
    startSlab.classList.add('start-hidden');
    endBlink.style.display = 'none';
    lastTick = performance.now();
    tick();
  }
  function pause(){
    running = false;
    if (rafId){ cancelAnimationFrame(rafId); rafId = null; }
    startSlab.classList.remove('start-hidden');
  }
  function resetElapsed(){
    elapsed = 0;
    scheduledBlueBlinks.clear();
    blinking = false;
    blinkMask.style.display = 'none';
    endBlink.style.display = 'none';
    clock.textContent = fmtSS(0);
    updateSegments(0);
    fitClockThrottled();
  }

  function tick(now){
    if (!running) return;
    if (!now) now = performance.now();
    const dt = (now - lastTick) / 1000;
    if (dt >= 0.25){
      const add = Math.floor(dt);
      elapsed += add;
      lastTick += add*1000;
      if (elapsed <= totalSec){
        clock.textContent = fmtSS(elapsed);
        fitClockThrottled();
        updateSegments(elapsed);
        handleBlueBlinkScheduling(); /* 0.5s on / 0.5s off blinks in blue */
        if (elapsed === totalSec){
          running = false;
          endBlink.style.display = 'block';
          return;
        }
      }
    }
    rafId = requestAnimationFrame(tick);
  }

  /* ---------- Blue phase blinks (remaining minutes): 0.5s color, 0.5s black ---------- */
  function atBlueBoundary(){
    const passed = elapsed;
    const blueStart = ySec + gSec;
    if (passed < blueStart || passed >= totalSec) return {ok:false};
    const blueElapsed = passed - blueStart;
    const remaining = bSec - blueElapsed;
    return {ok:true, remaining};
  }

  async function handleBlueBlinkScheduling(){
    const r = atBlueBoundary();
    if (!r.ok) return;
    const remaining = r.remaining;
    const wholeMinLeft = Math.ceil(remaining / 60);
    const atBoundary = (remaining % 60 === 0);
    if (atBoundary && wholeMinLeft > 0 && !scheduledBlueBlinks.has(wholeMinLeft)){
      // e.g., with 3-minute blue: fire at 17:00 (3), 18:00 (2), 19:00 (1)
      scheduledBlueBlinks.add(wholeMinLeft);
      await queueBlinkSequence(wholeMinLeft);
    }
  }

  const sleep = (ms)=>new Promise(r=>setTimeout(r,ms));
  async function queueBlinkSequence(n){
    while (blinking) await sleep(40);
    blinking = true;
    for (let i=0;i<n;i++){
      blinkMask.style.display = 'none';  // 0.5s color
      await sleep(500);
      blinkMask.style.display = 'block'; // 0.5s black
      await sleep(500);
    }
    blinkMask.style.display = 'none';
    blinking = false;
  }

  /* ---------- Settings: auto-hide FAB (show 5s after any tap) ---------- */
  let fabHideTimer = null;
  function showFabTemporarily(){
    if (sheet.classList.contains('open')) return;
    fab.classList.add('show');
    if (fabHideTimer) clearTimeout(fabHideTimer);
    fabHideTimer = setTimeout(()=>{ fab.classList.remove('show'); }, 5000);
  }

  // Show FAB on any click/tap (outside the open sheet)
  document.addEventListener('pointerdown', (e)=>{
    const path = e.composedPath ? e.composedPath() : [];
    if (path.includes(sheet)) return;
    showFabTemporarily();
  });

  // FAB toggles settings; clicking again saves/returns
  const openSettings = ()=>{
    sheet.classList.add('open');
    fab.classList.add('show');
    if (fabHideTimer) { clearTimeout(fabHideTimer); fabHideTimer=null; }
  };
  const closeSettings = ()=>{
    sheet.classList.remove('open');
    showFabTemporarily();
  };
  fab.addEventListener('click', ()=>{
    if (sheet.classList.contains('open')){ saveTimes(); closeSettings(); }
    else openSettings();
  });

  // Settings buttons
  pauseBtn.addEventListener('click', ()=>{ pause(); });
  returnBtn.addEventListener('click', ()=>{ saveTimes(); closeSettings(); });

  // Triple-click reset
  let clicks=0, clickTimer=null;
  resetBtn.addEventListener('click', ()=>{
    clicks++;
    if (clicks===1){ clickTimer = setTimeout(()=>{ clicks=0; }, 900); }
    if (clicks>=3){
      clearTimeout(clickTimer); clicks=0;
      pause();
      resetElapsed();
    }
  });

  // Start slab
  startBtn.addEventListener('click', ()=>{ closeSettings(); start(); });

  /* ---------- Save times / update UI ---------- */
  function saveTimes(){
    totalSec = ySec + gSec + bSec;
    refreshInfoBar();
    if (elapsed > totalSec) elapsed = totalSec;
    updateSegments(elapsed);
    positionMarkers();
    clock.textContent = fmtSS(elapsed);
    fitClockThrottled();
  }

  // Stepper logic (minutes/seconds)
  function updateDisplayVals(){
    yMinVal.textContent = Math.floor(ySec/60);
    ySecVal.textContent = String(Math.floor(ySec%60)).padStart(2,'0');
    gMinVal.textContent = Math.floor(gSec/60);
    gSecVal.textContent = String(Math.floor(gSec%60)).padStart(2,'0');
    bMinVal.textContent = Math.floor(bSec/60);
    bSecVal.textContent = String(Math.floor(bSec%60)).padStart(2,'0');
  }
  function adjust(seg, kind, delta){
    const clamp = (v)=>Math.max(0, Math.min(6*60*60, v)); // up to 6h per segment
    if (seg==='y'){
      if (kind==='m') ySec = clamp(ySec + delta*60); else ySec = clamp(ySec + delta);
    } else if (seg==='g'){
      if (kind==='m') gSec = clamp(gSec + delta*60); else gSec = clamp(gSec + delta);
    } else if (seg==='b'){
      if (kind==='m') bSec = clamp(bSec + delta*60); else bSec = clamp(bSec + delta);
    }
    updateDisplayVals();
    totalSec = ySec + gSec + bSec;
    refreshInfoBar();
    positionMarkers();
    updateSegments(elapsed);
  }
  document.querySelectorAll('.btnStep').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const seg = btn.getAttribute('data-seg');
      const kind = btn.getAttribute('data-kind');
      const d = parseInt(btn.getAttribute('data-d'),10);
      adjust(''+seg, ''+kind, d);
    });
  });

  /* ---------- Init ---------- */
  applyOrientationClass();
  updateDisplayVals();
  refreshInfoBar();
  positionMarkers();
  updateSegments(0);
  clock.textContent = fmtSS(0);
  fitClock();
  showFabTemporarily(); // reveal ⚙️ briefly on load

  window.addEventListener('resize', fitClockThrottled);
  window.addEventListener('orientationchange', fitClockThrottled);

  // Optional keyboard helpers
  window.addEventListener('keydown', (e)=>{
    if (e.key === ' '){ e.preventDefault(); running ? pause() : start(); }
    else if (e.key.toLowerCase()==='s'){ sheet.classList.contains('open') ? (saveTimes(), closeSettings()) : openSettings(); }
    else if (e.key.toLowerCase()==='r'){ pause(); resetElapsed(); }
  });
})();
</script>
</body>
</html>
